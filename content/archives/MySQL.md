---
title: "MySQL"
date: 2022-04-22T18:36:14+08:00
draft: false
categories: [数据库]
series: [面试]
tags: [数据库, 面试, MySQL]
summary: "MySQL面试相关内容."
---

# MySQL



## 存储引擎

MySQL 常用存储引擎为 `MyISAM` 和 `InnoDB` 两种
在 `MySQL 5.5.5` 版本开始默认存储引擎从 `MyISAM` 改为 `InnoDB`



> 存储引擎相关命令

- 查看提供的所有存储引擎：`show engines`
- 查看默认存储引擎：`show variables like '%storage_engine%';`
- 查看表的存储引擎：`show table status like "table_name" ;`



> MyISAM与InnoDB的区别

- 锁级别：MyISAM支持表级锁，不支持行级锁，InnoDB都支持
- 事务：MyISAM不支持事务，InnoDB支持事务，可提交和回滚
- 外键：MyISAM不支持外键，InnoDB支持外键
- 安全恢复：InnoDB可使用事务日志进行自动恢复，MyISAM不支持
- 性能：InnoDB具有更高的写入速度，处理大量数据性能更高，MyISAM读取速度更快
- 缓存和索引：InnoDB支持缓存数据和索引的大型缓冲区池，不支持全文搜索，MyISAM密钥缓冲区仅用于索引，支持全文搜索



## 事务

在逻辑上为一个整体的多个操作，即要么都执行，要么都不执行

### 四大特性ACID

- **原子性**（`Atomicity`） ： 事务是最小的执行单位，不允许分割。事务的原子性确保动作要么全部完成，要么完全不起作用；
- **一致性**（`Consistency`）： 执行事务前后，数据保持一致，例如转账业务中，无论事务是否成功，转账者和收款人的总额应该是不变的；
- **隔离性**（`Isolation`）： 并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务之间数据库是独立的；
- **持久性**（`Durability`）： 一个事务被提交之后。它对数据库中数据的改变是持久的，即使数据库发生故障也不应该对其有任何影响。



#### 实现原理

- MySQL InnoDB 引擎使用 **redo log(重做日志)** 保证事务的**持久性**，使用 **undo log(回滚日志)** 来保证事务的**原子性**。
- MySQL InnoDB 引擎通过 **锁机制**、**MVCC** 等手段来保证事务的隔离性（ 默认支持的隔离级别是 **`REPEATABLE-READ`** ）。
- 保证了事务的持久性、原子性、隔离性之后，一致性才能得到保障



### 并发事务带来的问题

- 丢失修改：两个事务对同一个数据进行修改，后一个覆盖了前一个
- 脏读：读到另一个事务没有提交的数据
- 不可重复读：在一个事务中，对一组数据多次读取，得到的结果不一致
- 幻读：在一个事务中读取数据，读取的数据条数不一致



### 隔离级别

- 读未提交：允许读取其他事务未提交的数据，存在脏读、不可重复读、幻读问题
- 读已提交：只允许读其他事务已提交的数据，存在不可重复读、幻读问题
- 可重复读：对同一数据多次读取结果一致，存在幻读问题，InnoDB默认隔离级别
- 可串行化：所有事务逐个执行，可解决以上所有问题



## 索引

索引是一种用于快速查询和检索数据的数据结构

MySQL索引使用的数据结构为B+树

### B+树的优点

与Hash表相比

- Hash存在Hash冲突问题
- Hash不支持顺序查找和范围查找

与B树相比

- B+树的key和data都存放在叶子节点
- B+树的叶子节点有一条引用链指向与它相邻的叶子节点
- B+树的检索效率更稳定

与红黑树相比：

- 有更低的层数，因此磁盘访问次数更少



### 索引类型

#### 聚簇索引和非聚簇索引

- 聚簇索引：存储记录是物理上连续存在，物理存储按照索引排序，有利于范围查询，一张表中只能有一个聚簇索引。
- 非聚簇索引：非聚集索引是逻辑上的连续，物理存储并不连续，物理存储不按照索引排序。



#### 覆盖索引

一个索引如果包含需要查询的字段，就是覆盖索引

比如name字段有索引，`select name from student where name = ‘xxxx’`



#### 创建索引注意点

- 选择合适的字段
  - 不为NULL的
  - 频繁查询的
  - 频繁需要排序的
  - 频繁用于连接的
  - 频繁作为条件查询的
- 频繁更新的需谨慎
- 尽可能建立联合索引
- 字符串字段使用前缀索引，占用空间更新
- 避免冗余索引



## 日志

### redo log

是InnoDB所独有的，让MySQL拥有了崩溃恢复能力

### undo log



### bin log
